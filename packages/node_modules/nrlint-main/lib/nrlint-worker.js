const FlowParser = require('@node-red/flow-parser');
const Linter = require("./linter");

Linter.init({
    resolveRule: function(ruleName) {
        return nrlint.rules[ruleName]
    }
})

console.log("Node-RED Lint Worker started")

nrlint = {
    rules: {}
};

onmessage = function(event) {
    var msg = event.data;
    if (msg.cmd === 'load') {
        handleLoad(msg.url);
    } else if (msg.cmd === 'lint') {
        runLint(msg.flow, msg.config);
    }
};

function handleLoad(url) {
    importScripts(url)
}

function runLint(flow, config) {
    if (!config || !config.rules) {
        return;
    }
    var result = Linter.lint(flow, config);
    postMessage({
        "cmd": "result",
        "result": result
    })
}
